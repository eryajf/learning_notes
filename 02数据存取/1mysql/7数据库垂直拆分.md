## 数据库垂直拆分

### 分库分表
把一个很大的库（表）的数据分到几个库（表）中，每个库（表）的结构都相同

### mysql的分区表
所有数据还在一个表中，但物理存储根据一定的规则放在不同的文件中。这个是mysql支持的功能，业务rd代码无需改动。

为什么使用的少?
1. 分区表，分区键设计不太灵活，如果不走分区键，很容易出现全表锁
2. 一旦数据量并发量上来，如果在分区表实施关联，就是一个灾难
3. 自己分库分表，自己掌控业务场景与访问模式，可控

### 垂直切分的依据是什么
1. 将长度较短，访问频率较高的属性尽量放在一个表里，这个表暂且称为主表
2. 将字段较长，访问频率较低的属性尽量放在一个表里，这个表暂且称为扩展表
3. 如果1和2都满足,经常一起访问的属性，也可以放在一个表里

### 数据量大
数据量并发量比较大时，数据库的上层都会有一个服务层。需要注意的是，当应用方需要同时访问主表和扩展表中的属性时，服务层不要使用join来连表访问，而应该分两次进行查询

原因:
1. join更消损耗数据库性能
2. join会让base表和ext表耦合在一起（必须在一个数据库实例上），不利于数据量大时拆分到不同的数据库实例上（机器上）。毕竟减少数据量，提升性能才是垂直拆分的初衷

### 为什么要这么这么拆分
为何要将字段短，访问频率高的属性放到一个表内？为何这么垂直拆分可以提升性能？因为：
1. 数据库有自己的内存buffer，会将磁盘上的数据load到内存buffer里（暂且理解为进程内缓存吧）
2. **内存buffer缓存数据是以row为单位的**
3. 在内存有限的情况下，在数据库内存buffer里**缓存短row，就能缓存更多的数据**
4. 在数据库内存buffer里缓存访问频率高的row，就能提升缓存命中率，减少磁盘的访问
   
### 总结
1. 水平拆分和垂直拆分都是降低数据量大小，提升数据库性能的常见手段
2. 流量大，数据量大时，数据访问要有service层，并且service层不要通过join来获取主表和扩展表的属性
3. 垂直拆分的依据，尽量把长度较短，访问频率较高的属性放在主表里

### 高并发在线表结构变更
1. 新表+触发器+迁移数据+rename  
2. 拓展表,但是不要join,高并发下,上层提供服务层,进行数据聚合
3. 

不可选方案:
1. alter table *需要锁表,服务不可用*
2. 通过增加表的方式扩展，通过外键join来查询 *大数据高并发情况下，join性能较差*
3. 通过增加表的方式扩展，通过视图来对外 *同上*

### mysql常见的水平切分方式有哪些？
- 分库分表
- 分区表
